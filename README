== About i-tee
i-tee is a distance laboratory system, that is based on ruby on rails and uses virtualization technologies like libvirt.
i-tee is developed by the Estonian IT College.

== Application Config
Configuration files are needed as following with sample files included:

- config/environments/development.rb
- config/environments/production.rb
- config/environments/test.rb

- config/ldap.yml
- config/database.yml


== Installation

Check the version of ruby and rails installed:

ruby -v
ruby 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux]

rails -v
Rails 3.0.0

Have git installed:
apt-get install git-core

Create the railsapps directory
mkdir /var/www/railsapps/

Download the code from GitHub to the newly created folder
cd /var/www/railsapps
git clone git://github.com/magavdraakon/i-tee.git

Go to the project folder
cd i-tee

Create config files from the sample files

Changing the database config
cp config/database_sample.yml config/database.yml 

For the database use mysql server.
apt-get install libmysqlclient-dev mysql-server

run the mysql client under root
mysql -p

Creating the user for the database:

create database itee_production character set utf8;
create user 'itee'@'localhost' identified by 's0mestrongpassw0rd';
grant all privileges on itee_production.* to 'itee'@'localhost';

Change info in the database.yml file

production:
  adapter: mysql
  database: itee_production
  username: itee
  password: s0mestrongpassw0rd

Getting the production config
cp config/environments/production_sample.rb config/environments/production.rb 

Ensure that emulate_virtualization is set to false
  config.emulate_virtualization = false
  config.emulate_eucalyptus = false
  config.emulate_ldap = false

Enter correct eucalyptus url and creditentials
  #eycalyptus aws information
  config.ec2_url = 'http://youreucaIP:8773/services/Eucalyptus'
  config.access_key = 'access key from your installation'
  config.secret_key = 'secret key from your euca installation'

  #Administrator usernames
  config.admins = ['admin1','admin2','admin3','etc']
  
Create the LDAP config
cp config/ldap_sample.yml config/ldap.yml 

And change the info according to your own LDAP server settings
production:
  host: yourhost
  port: 636
  attribute: cn
  base: ou=people,dc=test,dc=com
  admin_user: cn=admin,dc=test,dc=com
  admin_password: admin_password
  ssl: true

install the sqlite development packages
apt-get install libsqlite3-dev 

Install gems
bundle install

Now migrate the database
RAILS_ENV=production rake db:migrate


install passenger for hosting rails applications 
gem install passenger

Install the required software:

  Curl development headers with SSL support
  apt-get install libcurl4-openssl-dev

  OpenSSL development headers
  apt-get install libssl-dev

  Apache 2 development headers
  apt-get install apache2-prefork-dev

  Apache Portable Runtime (APR) development headers
  apt-get install libapr1-dev

  Apache Portable Runtime Utility (APU) development headers
  apt-get install libaprutil1-dev

And run the installer
passenger-install-apache2-module

Create new configuration files to enable passenger
/etc/apache2/mods-available/passenger.load
/etc/apache2/mods-available/passenger.conf

insert the following line into the .load file
LoadModule passenger_module /usr/lib/ruby/gems/1.8/gems/passenger-3.0.2/ext/apache2/mod_passenger.so

insert the following lines into the .conf file
PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-3.0.2
PassengerRuby /usr/bin/ruby1.8

execute these commands to enable passenger and restart the apache server
a2enmod passenger
/etc/init.d/apache2 restart

Create a file 
/etc/apache2/sites-available/itee

And insert the following lines
<VirtualHost *:80>
    ServerName elab.itcollege.ee
    DocumentRoot /var/www/railsapps/i-tee/public
    <Directory /var/www/railsapps/i-tee/public>
       AllowOverride all
       Options -MultiViews
    </Directory>
</VirtualHost>

Disable the default site
a2dissite default

and enable the new site
a2ensite itee

reload the web servers configuration files
/etc/init.d/apache2 reload

To see the site go to
http://localhost

== Authors
Tiia TÃ¤nav
Margus Ernits
Carolyn Fischer (retired)
Aivar Guitar (retired)
Madis Toom (retired)

